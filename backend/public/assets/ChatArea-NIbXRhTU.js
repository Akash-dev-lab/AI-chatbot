import{l as O,j as e,A as P,m as z}from"./vendor-Deb2PdYT.js";import{a}from"./react-CFQ-Nn85.js";import{u as L,d as h}from"./redux-CJFldUpq.js";import{d as f,e as U}from"./index-BOO-sXkq.js";import{a as B,d as T}from"./index-Dksf2cMk.js";const $=()=>{const r=L(),{items:x,loading:k}=h(s=>s.messages),{activeChatId:t,list:I}=h(s=>s.chats),g=h(s=>s.user),b=t?I.find(s=>s._id===t):null,[l,j]=a.useState(""),[d,y]=a.useState(!1),[u,m]=a.useState(!1),p=a.useRef(null),v=a.useRef(null),o=a.useRef(null),w=a.useRef(null);a.useEffect(()=>(o.current=O("https://ai-chatbot-1-qxr6.onrender.com",{withCredentials:!0}),o.current.on("ai-response",s=>{r(f({chatId:s.chat,content:s.content,role:"model"})),y(!1)}),()=>{o.current.disconnect()}),[r]),a.useEffect(()=>{t&&r(U(t))},[t,r]),a.useEffect(()=>{w.current?.scrollIntoView({behavior:"smooth"})},[x,t]),a.useEffect(()=>{const s=n=>{p.current&&!p.current.contains(n.target)&&m(!1)};return u&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[u]);const N=()=>{!l.trim()||!t||(r(f({chatId:t,content:l,role:"user"})),y(!0),o.current.emit("ai-message",{chat:t,content:l}),j(""))},R=()=>m(s=>!s),S=()=>{m(!1),v.current?.click()};function C(s){return new Promise((n,i)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>n(c.result),c.onerror=F=>i(F)})}const E=async s=>{const n=s.target.files?.[0];if(n){try{const i=await C(n);r(f({chatId:t,content:"[Image sent]",role:"user",imageUrl:i})),o.current.emit("ai-message",{chat:t,content:"",imageUrl:i})}catch(i){console.error("Image handling failed:",i)}s.target.value=""}},A=x[t]||[];return t?e.jsxs("div",{className:"chat-area",children:[e.jsx("div",{className:"chat-header",children:b?`${b.title}✨`:"No chat selected"}),e.jsxs("div",{className:"messages",children:[k?e.jsx("p",{children:"Loading..."}):A.map((s,n)=>e.jsx("div",{className:`chat-message ${s.role==="user"?"user-msg":"bot-msg"}`,children:s.role==="model"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/bot.png",alt:"Bot",className:"avatar w-50 h-50"}),e.jsx("div",{className:"bubble bot-bubble",children:s.content})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bubble user-bubble",children:s.content}),e.jsx("img",{src:g?.profilePic,alt:"User",className:"avatar"})]})},s._id||n)),d&&e.jsx("div",{className:"typing-indicator",children:e.jsxs("div",{className:"gemini-loader",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{ref:w})]}),t&&e.jsxs("div",{className:"chat-input",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:R,"aria-label":"Open options",style:{width:40,height:40,borderRadius:8,border:"none",background:"transparent",color:"white",fontSize:22,cursor:"pointer"},children:e.jsx(B,{})}),e.jsx(P,{children:u&&e.jsx(z.div,{initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},transition:{duration:.35,ease:"easeOut"},style:{position:"absolute",bottom:60,left:0,background:"#222",color:"white",borderRadius:10,padding:"10px 12px",boxShadow:"0 6px 20px rgba(0,0,0,0.6)",zIndex:2e3,minWidth:160},children:e.jsxs("div",{onClick:S,style:{display:"flex",alignItems:"center",gap:12,width:"150px",cursor:"pointer"},children:[e.jsx(T,{className:"text-xl"}),e.jsx("span",{className:"text-lg",children:"Upload Image"})]})},"options")})]}),e.jsx("input",{ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:E}),e.jsx("input",{type:"text",placeholder:"Type a message...",value:l,onChange:s=>j(s.target.value),onKeyDown:s=>s.key==="Enter"&&N(),disabled:d,style:{flex:1,padding:"12px 16px",borderRadius:24,background:"rgba(30,30,30,0.9)",color:"white",border:"1px solid rgba(255,255,255,0.04)"}}),e.jsx("button",{onClick:N,disabled:d,style:{marginLeft:8,width:44,height:44,borderRadius:12,border:"none",background:"transparent",color:"white",fontSize:18,cursor:"pointer"},children:"➤"})]})]}):e.jsxs("div",{className:"flex items-center justify-center flex-col gap-5 h-full w-full px-4",children:[e.jsxs("h2",{className:"welcome-title",style:{fontSize:"clamp(2rem, 8vw, 6rem)",textAlign:"center",wordBreak:"break-word"},children:["Welcome, ",g?.name||"Guest"]}),e.jsxs("p",{className:"welcome-desc",style:{fontSize:"clamp(1rem, 3vw, 2.5rem)",fontWeight:200,textAlign:"center"},children:["I am Your Personal AI Assistent ",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"clamp(0.8rem, 2vw, 1.25rem)",display:"block",marginTop:"0.5em"},children:"Powered by Gemini-2.5-flash"})]})]})};export{$ as default};
