import{j as e,l as F,A as O,m as T}from"./vendor-Deb2PdYT.js";import{a}from"./react-CFQ-Nn85.js";import{u as L,d as b}from"./redux-CJFldUpq.js";import{d as v,e as B}from"./index-BOLsRtGG.js";import{a as D,d as W}from"./index-Dksf2cMk.js";const G=({text:n,speed:l=25})=>{const[h,t]=a.useState("");return a.useEffect(()=>{let o=0;const c=setInterval(()=>{t(m=>m+n.charAt(o)),o++,o>=n.length&&clearInterval(c)},l);return()=>clearInterval(c)},[n,l]),e.jsx("div",{className:"whitespace-pre-line",children:h})},V=()=>{const n=L(),{items:l,loading:h}=b(s=>s.messages),{activeChatId:t,list:o}=b(s=>s.chats),c=b(s=>s.user),m=t?o.find(s=>s._id===t):null,[u,y]=a.useState(""),[x,w]=a.useState(!1),[f,g]=a.useState(!1),j=a.useRef(null),N=a.useRef(null),d=a.useRef(null),I=a.useRef(null),[k,R]=a.useState(null);a.useEffect(()=>(d.current=F("https://ai-chatbot-1-qxr6.onrender.com",{withCredentials:!0}),d.current.on("ai-response",s=>{n(v({chatId:s.chat,content:s.content,role:"model",isNew:!0})),w(!1)}),()=>{d.current.disconnect()}),[n]),a.useEffect(()=>{t&&n(B(t))},[t,n]),a.useEffect(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[l,t]),a.useEffect(()=>{const s=r=>{j.current&&!j.current.contains(r.target)&&g(!1)};return f&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[f]);const S=()=>{!u.trim()||!t||(n(v({chatId:t,content:u,role:"user"})),w(!0),d.current.emit("ai-message",{chat:t,content:u}),y(""))},C=()=>g(s=>!s),E=()=>{g(!1),N.current?.click()};function A(s){return new Promise((r,i)=>{const p=new FileReader;p.readAsDataURL(s),p.onload=()=>r(p.result),p.onerror=U=>i(U)})}const z=async s=>{const r=s.target.files?.[0];if(r){try{const i=await A(r);n(v({chatId:t,content:"[Image sent]",role:"user",imageUrl:i})),d.current.emit("ai-message",{chat:t,content:"",imageUrl:i})}catch(i){console.error("Image handling failed:",i)}s.target.value=""}},P=l[t]||[];return t?e.jsxs("div",{className:"chat-area",children:[e.jsx("div",{className:"chat-header",children:m?`${m.title}✨`:"No chat selected"}),e.jsxs("div",{className:"messages",children:[h?e.jsx("p",{children:"Loading..."}):P.map((s,r)=>e.jsx("div",{className:`chat-message ${s.role==="user"?"user-msg":"bot-msg"}`,children:s.role==="model"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/bot.png",alt:"Bot",className:"avatar w-50 h-50"}),e.jsx("div",{className:"bubble bot-bubble",children:s.isNew?e.jsx(G,{text:s.content,speed:25}):e.jsx("div",{className:"whitespace-pre-line",children:s.content})})]}):e.jsxs(e.Fragment,{children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"sent",className:"max-w-[200px] rounded-lg shadow-md cursor-pointer transition-transform duration-300 hover:scale-105",onClick:()=>R(s.imageUrl)}):e.jsx("p",{className:"bubble user-bubble",children:s.content}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:()=>R(null),children:e.jsx("img",{src:k,alt:"preview",className:"max-h-[90%] max-w-[90%] rounded-xl shadow-2xl transform scale-90 animate-zoomIn"})}),e.jsx("img",{src:c?.profilePic,alt:"User",className:"avatar"})]})},s._id||r)),x&&e.jsx("div",{className:"typing-indicator",children:e.jsxs("div",{className:"gemini-loader",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{ref:I})]}),t&&e.jsxs("div",{className:"chat-input",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{position:"relative"},ref:j,children:[e.jsx("button",{onClick:C,"aria-label":"Open options",style:{width:40,height:40,borderRadius:8,border:"none",background:"transparent",color:"white",fontSize:22,cursor:"pointer"},children:e.jsx(D,{})}),e.jsx(O,{children:f&&e.jsx(T.div,{initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},transition:{duration:.35,ease:"easeOut"},style:{position:"absolute",bottom:60,left:0,background:"#222",color:"white",borderRadius:10,padding:"10px 12px",boxShadow:"0 6px 20px rgba(0,0,0,0.6)",zIndex:2e3,minWidth:160},children:e.jsxs("div",{onClick:E,style:{display:"flex",alignItems:"center",gap:12,width:"150px",cursor:"pointer"},children:[e.jsx(W,{className:"text-xl"}),e.jsx("span",{className:"text-lg",children:"Upload Image"})]})},"options")})]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",style:{display:"none"},onChange:z}),e.jsx("input",{type:"text",placeholder:"Type a message...",value:u,onChange:s=>y(s.target.value),onKeyDown:s=>s.key==="Enter"&&S(),disabled:x,style:{flex:1,padding:"12px 16px",borderRadius:24}}),e.jsx("button",{onClick:S,disabled:x,style:{marginLeft:8,width:44,height:44,borderRadius:12,border:"none",background:"transparent",color:"white",fontSize:18,cursor:"pointer"},children:"➤"})]})]}):e.jsxs("div",{className:"flex items-center justify-center flex-col gap-5 h-full w-full px-4",children:[e.jsxs("h2",{className:"welcome-title",style:{fontSize:"clamp(2rem, 8vw, 6rem)",textAlign:"center",wordBreak:"break-word"},children:["Welcome, ",c?.name||"Guest"]}),e.jsxs("p",{className:"welcome-desc",style:{fontSize:"clamp(1rem, 3vw, 2.5rem)",fontWeight:200,textAlign:"center"},children:["I am Your Personal AI Assistent ",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"clamp(0.8rem, 2vw, 1.25rem)",display:"block",marginTop:"0.5em"},children:"Powered by Gemini-2.5-flash"})]})]})};export{V as default};
