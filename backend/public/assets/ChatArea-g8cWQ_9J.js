import{l as F,j as e,A as O,m as L}from"./vendor-Deb2PdYT.js";import{a}from"./react-CFQ-Nn85.js";import{u as B,d as h}from"./redux-CJFldUpq.js";import{d as x,e as T}from"./index-CUrtdhnc.js";import{a as D,d as W}from"./index-Dksf2cMk.js";const K=()=>{const r=B(),{items:f,loading:R}=h(s=>s.messages),{activeChatId:t,list:S}=h(s=>s.chats),g=h(s=>s.user),b=t?S.find(s=>s._id===t):null,[l,j]=a.useState(""),[d,y]=a.useState(!1),[m,u]=a.useState(!1),p=a.useRef(null),w=a.useRef(null),o=a.useRef(null),v=a.useRef(null),[N,k]=a.useState(null);a.useEffect(()=>(o.current=F("https://ai-chatbot-1-qxr6.onrender.com",{withCredentials:!0}),o.current.on("ai-response",s=>{r(x({chatId:s.chat,content:s.content,role:"model"})),y(!1)}),()=>{o.current.disconnect()}),[r]),a.useEffect(()=>{t&&r(T(t))},[t,r]),a.useEffect(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[f,t]),a.useEffect(()=>{const s=n=>{p.current&&!p.current.contains(n.target)&&u(!1)};return m&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[m]);const I=()=>{!l.trim()||!t||(r(x({chatId:t,content:l,role:"user"})),y(!0),o.current.emit("ai-message",{chat:t,content:l}),j(""))},C=()=>u(s=>!s),E=()=>{u(!1),w.current?.click()};function z(s){return new Promise((n,i)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>n(c.result),c.onerror=U=>i(U)})}const A=async s=>{const n=s.target.files?.[0];if(n){try{const i=await z(n);r(x({chatId:t,content:"[Image sent]",role:"user",imageUrl:i})),o.current.emit("ai-message",{chat:t,content:"",imageUrl:i})}catch(i){console.error("Image handling failed:",i)}s.target.value=""}},P=f[t]||[];return t?e.jsxs("div",{className:"chat-area",children:[e.jsx("div",{className:"chat-header",children:b?`${b.title}✨`:"No chat selected"}),e.jsxs("div",{className:"messages",children:[R?e.jsx("p",{children:"Loading..."}):P.map((s,n)=>e.jsx("div",{className:`chat-message ${s.role==="user"?"user-msg":"bot-msg"}`,children:s.role==="model"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/bot.png",alt:"Bot",className:"avatar w-50 h-50"}),e.jsx("div",{className:"bubble bot-bubble",children:s.content})]}):e.jsxs(e.Fragment,{children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"sent",className:"max-w-[200px] rounded-lg shadow-md cursor-pointer transition-transform duration-300 hover:scale-105",onClick:()=>k(s.imageUrl)}):e.jsx("p",{className:"bubble user-bubble",children:s.content}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:()=>k(null),children:e.jsx("img",{src:N,alt:"preview",className:"max-h-[90%] max-w-[90%] rounded-xl shadow-2xl transform scale-90 animate-zoomIn"})}),e.jsx("img",{src:g?.profilePic,alt:"User",className:"avatar"})]})},s._id||n)),d&&e.jsx("div",{className:"typing-indicator",children:e.jsxs("div",{className:"gemini-loader",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{ref:v})]}),t&&e.jsxs("div",{className:"chat-input",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:C,"aria-label":"Open options",style:{width:40,height:40,borderRadius:8,border:"none",background:"transparent",color:"white",fontSize:22,cursor:"pointer"},children:e.jsx(D,{})}),e.jsx(O,{children:m&&e.jsx(L.div,{initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},transition:{duration:.35,ease:"easeOut"},style:{position:"absolute",bottom:60,left:0,background:"#222",color:"white",borderRadius:10,padding:"10px 12px",boxShadow:"0 6px 20px rgba(0,0,0,0.6)",zIndex:2e3,minWidth:160},children:e.jsxs("div",{onClick:E,style:{display:"flex",alignItems:"center",gap:12,width:"150px",cursor:"pointer"},children:[e.jsx(W,{className:"text-xl"}),e.jsx("span",{className:"text-lg",children:"Upload Image"})]})},"options")})]}),e.jsx("input",{ref:w,type:"file",accept:"image/*",style:{display:"none"},onChange:A}),e.jsx("input",{type:"text",placeholder:"Type a message...",value:l,onChange:s=>j(s.target.value),onKeyDown:s=>s.key==="Enter"&&I(),disabled:d,style:{flex:1,padding:"12px 16px",borderRadius:24,background:"rgba(30,30,30,0.9)",color:"white",border:"1px solid rgba(255,255,255,0.04)"}}),e.jsx("button",{onClick:I,disabled:d,style:{marginLeft:8,width:44,height:44,borderRadius:12,border:"none",background:"transparent",color:"white",fontSize:18,cursor:"pointer"},children:"➤"})]})]}):e.jsxs("div",{className:"flex items-center justify-center flex-col gap-5 h-full w-full px-4",children:[e.jsxs("h2",{className:"welcome-title",style:{fontSize:"clamp(2rem, 8vw, 6rem)",textAlign:"center",wordBreak:"break-word"},children:["Welcome, ",g?.name||"Guest"]}),e.jsxs("p",{className:"welcome-desc",style:{fontSize:"clamp(1rem, 3vw, 2.5rem)",fontWeight:200,textAlign:"center"},children:["I am Your Personal AI Assistent ",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"clamp(0.8rem, 2vw, 1.25rem)",display:"block",marginTop:"0.5em"},children:"Powered by Gemini-2.5-flash"})]})]})};export{K as default};
